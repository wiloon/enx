import { JSDOM } from "jsdom";
import { findChildNodes } from '../content_module';

let pageSource = `
<table border="0" cellpadding="0" cellspacing="0" style="margin-right: auto; margin-left: auto" width="600" align="center"><tr><td><![endif]--><table width="100%" align="left" border="0" style="margin:0" bgcolor="#FFFFFF"><tbody><tr><td id="EMAIL_CONTAINER" align="left" width="100%"><div style="margin:0 auto;max-width:600px;width:100%"><table border="0" cellpadding="0" cellspacing="0" style="width:100%"><tbody><tr><td style="padding:15px 0 5px;text-align:center;width:100%"><div style="font-family:arial,sans-serif;font-size:12px;text-align:center;width:100%;padding-bottom:10px"><a title="View in browser" href="https://messaging-custom-newsletters.nytimes.com/dynamic/render?isViewInBrowser=true&paid_regi=0&productCode=NN&sendId=192164&uri=nyt%3A%2F%2Fnewsletter%2F1ce50632-0df0-5edc-9ac3-e133f9578ad7" class="css-sdwaa1" style="color:#666;-webkit-text-decoration:none;text-decoration:none;line-height:18px">View in browser</a>
<span id="span_bar" style="color:#dcdcdc;margin:0 10px">|</span>
<a title="The New York Times" href="https://www.nytimes.com/" class="css-sdwaa1" style="color:#666;-webkit-text-decoration:none;text-decoration:none;line-height:18px">nytimes.com</a></div><table border="0" cellpadding="0" cellspacing="0" style="width:100%"><tbody><tr aria-hidden="true"><td><span style="text-align:center;line-height:0;font-size:0"><table style="margin:0 auto" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><a rel="noopener noreferrer nofollow" tabindex="-1" target="_blank" href="https://liveintent.newyorktimesinfo.com/click?s=859181&li=NN&m={{ generateMD5Hash .RecipientEmailAddress }}&p=NN_20250503&stpe=default" class="css-sdwaa1" style="color:#286ed0;-webkit-text-decoration:underline;text-decoration:underline"><img alt="Ad" src="https://liveintent.newyorktimesinfo.com/imp?s=859181&li=NN&m={{ generateMD5Hash .RecipientEmailAddress }}&p=NN_20250503&stpe=default" width="600" style="width:100%;max-width:600px"></a></td></tr></tbody></table></span></td></tr><tr><td height="10"></td></tr></tbody></table></td></tr></tbody></table><table border="0" cellpadding="0" cellspacing="0" style="width:100%"><tbody><tr><td style="border-top:1px solid #dcdcdc"></td></tr><tr><td style="padding:19px 0 0;width:100%;text-align:center" class="css-37loo4"><div style="margin-bottom:15px"><a title="The Morning" class="css-sdwaa1" style="color:#286ed0;-webkit-text-decoration:underline;text-decoration:underline"><img src="https://static.nytimes.com/email-images/N-TheMorning%402x.png" alt="The Morning" width="300" style="width:300px" class="css-r2ey6x"></a></div><p style="width:100%;margin-bottom:31px;font:12px/12px georgia,serif">February 28, 2025</p><p style="font-size:0;line-height:0;margin:0" aria-hidden="true"><a rel="noopener noreferrer nofollow" tabindex="-1" target="_blank" href="https://liveintent.newyorktimesinfo.com/click?s=1080679&li=NN&m={{ generateMD5Hash .RecipientEmailAddress }}&p=NN_20250503&stpe=default" class="css-sdwaa1" style="color:#286ed0;-webkit-text-decoration:underline;text-decoration:underline"><img alt="Ad" src="https://liveintent.newyorktimesinfo.com/imp?s=1080679&li=NN&m={{ generateMD5Hash .RecipientEmailAddress }}&p=NN_20250503&stpe=default&li_coord=desktop&collapse_width=600" width="600" style="max-width:600px;width:100%"></a></p></td></tr><tr><td style="border-bottom:1px solid #dcdcdc"></td></tr><tr><td height="20"></td></tr></tbody></table><div style="margin:0 auto;max-width:600px;width:100%"><table style="width:100%" cellpadding="0"><tbody><tr><td style="padding:0 9px 0 0;box-sizing:content-box;vertical-align:middle;width:45px" width="45" valign="middle"><a class="css-sdwaa1" href="https://www.nytimes.com/by/german-lopez" style="-webkit-text-decoration:underline;text-decoration:underline;color:inherit"><img src="https://static01.nyt.com/images/2022/01/13/reader-center/author-german-lopez/author-german-lopez-blogSmallThumb-v2.png" alt="Author Headshot" style="width:45px;height:45px;border-radius:100%" width="45" height="45"></a></td><td style="padding:0;box-sizing:content-box;vertical-align:middle" valign="middle"><p style="font:13px/18px arial,sans-serif;letter-spacing:.2px;color:#000;font:600 13px/18px arial,sans-serif;margin-bottom:3px">By <a class="css-nanfcg" href="https://www.nytimes.com/by/german-lopez" style="-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:none;text-decoration:none;border-bottom:1px solid #ccc;color:inherit">German Lopez</a></p></td></tr><tr><td height="15"></td></tr></tbody></table></div><p style="display:block;color:#333;font:400 18.5px/26px georgia,serif;margin:0 0 10px"><span>Good morning. We’re reporting on the latest from Washington. We’re also covering cartels, federal workers and K-pop.</span></p>
`
test('paragraph test', () => {
    const tmp_dom = new JSDOM(pageSource);
    let articleNode = tmp_dom.window.document.getElementById("EMAIL_CONTAINER");
    console.log("article node, tag:", articleNode.tagName, "id:", articleNode.id);
    let nodeList = findChildNodes(articleNode);

    console.log("*** print node list ***");
    let index = 0;
    for (let node of nodeList) {
        console.log("result node, index: ", index, "paragraph: ", node.paragraph);
        index++;
    }
    console.log(nodeList.length);
    expect(nodeList.length).toBe(3);

    // 检查第三个节点的文本内容
    expect(nodeList[2].paragraph).toBe("Good morning. We’re reporting on the latest from Washington. We’re also covering cartels, federal workers and K-pop.");
});
